# 互联网金融大数据离线数仓
- 场景
  - 公司从0到1
  - 公司已经有平台
  - 了解业务，才能对数据进行业务赋能
- 消费金融
  - 场景：如蚂蚁花呗
  - 业务：客户群体，个人消费，用途是消费而非生产经营
  - xx研究院：业务产出，输出业务流程图
  - 业务流程图
    - 资金提供方
    - 消费金融服务商
    - 资金需求方
    - 消费场景
    - 第三方数据源
  - 业务背景：核心信贷系统（核心：最大价值），营销中心，运营中心，风控中心
  - 服务对象: 销售，客服，管理，运营，财务，风控
  - 应用背景：信贷业务核算，面向核心信贷业务，客服的运营管理和风控管理，营销的智能化建设
- 发展历史
  - kettle+mysql/oracel
  - 大数据开源技术架构：hadoop,hdfs,spark,kafak,flink
  - 全链路自动化，智能化，数据产品矩阵:数据分析师的失去，标签的定义。拖来拽式开发
- 数仓从0-1的挑战
  - 大量的业务涌入
  - 业务不断整合升级
  - 数据应用需求快速上涨
  - 数据需求高频迭代
- 架构分层
  - 数据探查：深入埋点系统，业务系统进行相关信息调研
  - 架构设计：根据数据探查结果，全链路优化分层主题建设
  - 模型设计：根据复杂业务数据需求，抽象模型设计模式
  - 分层
    - 数据主题层
      - ods：数据贴源层，从各个业务系统中获取日志，原始，快照，历史等，用sqoop,datax进行数据的抽取
      - dwd:明细层，对数据的标准，打通，明细，类似我们的mrloc数据用户定位，mr数据,用户小区信号质量数据，s1mme数据用户信号信令数据
      - dws:轻度聚合层，公用，多维，我是用spark进行数据的连接，生成多维表，然后写入clickhouse,供下游使用
      - ads:数据的应用层，如自忙时，高负荷，高价值物点
    - 数据服务层（中台）
      - 接口，订阅发布，
- 深入业务系统信息调研 
  - 常见问题
    - 业务经验要求高
    - 信息调研的细节和深度不够
    - 个体调研点不同
    - 系统联系弱
  - 业务系统资料准备：资产沉淀，wiki
  - 系统调研
    - 业务系统产品，研发沟通
  - 表级别分析
    - 表的业务含义
    - 表间的关系分析
    - 表级别调研，沟通
    - 验证
  - 字段级别分析
    - 确定重点字段
    - 表中字段含义
    - 表间字段的关系
    - 验证
  - 信息拆解
    - 业务对象流程绑定，过程拆解
  - 信息导图
  - 数据表字段，er图
- 拆解业务过程
  - 业务实体
    - 用户
      - 意向购买产品/使用服务
      - 消费贷款申请
        - 对象
        - 关系
          - 用户id
          - 渠道申请编号
        - 事实维度
          - 订单类型
          - 贷款类型细分
          - 业务类型
          - 是否发资方
          - 是否被拒绝
          - 地域
        - 时间维度
          - 创建时间
          - 最后修改时间
        - 度量
          - 申请人数
          - 申请人金额
          - 申请人通过数
    - 产品供给方
    - 金融平台
    - 资金提供方
    - 信贷全流程-风控领域（场景流模型）
      - 用户注册
      - 登录
      - 开户绑卡
      - 申请授信
      - 确认用信
    - 运营领域
      - app启动
        - 产品完整使用次数
        - 活跃人数
      - 注册
      - 实名认证
      - 提交授信申请
        - 指标体系拆解
          - 功能渗透
            - 关键：渗透渠道，以及各个渠道的跳出
            - 点击授信申请的前向来源分布
            - 授信申请人数次数
            - 借款申请跳出率
          - 功能转化
            - 多维度的分析,寻找阻塞点和阻塞场景
            - 借款主流程转化率（漏斗），数据入到clickhouse,借助数据分析引擎，通过拖拉拽开发
          - 功能留存
            - 对留存的贡献
          - 关键维度：设备类型，新老用户
  - 实体关系
  - 事实维度
  - 度量指标
    - 维度业务过程矩阵
      - 公共维度
      - 事实维度
      - 时间维度
      - 业务过程和业务事件
- 优化分层主题建设
  - 主题抽象-通用企业经营模式
    - 人/组织，产品/服务，协议
    - 面向全域数据
  - 主题抽象-业务过程归纳整合
    - 业务域-业务过程-业务事件
    - 缺点：不够体系，容易变化过大
- 数仓2.0时代
  - 概述
    - 业务规模扩大
    - 系统升级
  - 优化分层主题建设
    - dwd层主题抽象
      - 参与人，销售，内部机构，产品，流量，地理位置区域，营销，渠道，财务，事件
    - dws层主题建设（维度建模去建设）
      - 抽象业务信息域
        - 客户，行为，核心信贷，交易，物流，资讯，营销，收入，合同
      - 抽象业务场景域
        - 自营，渠道，客户，财务
    - dwd层实体设计难点和挑战
      - 业务流程复杂
      - 业务细节多
      - 历史遗留问题（外包做过）
    - 抽象模型设计模式理论
      - 三范式建模
        - 不适合快速迭代，后期使用维护不方便
      - 维度建模
        - 不方便管理复杂的业务，不能快速的业务迭代
      - 通过三范式，抽象出业务实体和业务关系进行模式设计
      - 三种组织方法
        - 分类
          - 完全穷尽
          - 排他
          - 业务相关性
        - 递归
          - 单一叠加
          - 树形叠加
        - 历史
          - 快照
          - 历史拉链（缓慢变化维）
          - 时间序列（不同业务流程生命周期中，单一实体，不同的业务过程，在单一时间内，进行建模，观察业务流转情况）
      - 四种抽象模式升华成模型沉淀
        - 现金流向池：现金业务垂直切分
        - 总分模型：实体类垂直切分
        - 中转站模型：代理人模式
        - 场景流模型：
    - 如何沉淀数据资产
      - 在不同的业务阶段采用不同的主题组织和建模方式
      - 信息调研是数据仓库的基础
      - 方法论不断进化
      - 模型抽象
      - 
